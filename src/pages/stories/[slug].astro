---
import Layout from "../../layouts/Layout.astro"
import type { Story } from "../../lib/blog"
import StoryblokComponent from "@storyblok/astro/StoryblokComponent.astro"
import { useStoryblokApi } from "@storyblok/astro"

export async function getStaticPaths() {
  const { data } = await useStoryblokApi().getStories({
    version: import.meta.env.DEV ? "draft" : "published",
    sort_by: "content.createdAt:desc",
  })

  return data.stories.map((story) => ({
    params: {
      slug: story.slug,
    },
  }))
}

const { slug } = Astro.params

const storyblokApi = useStoryblokApi()

const { data } = await storyblokApi.get(`cdn/stories/stories/${slug}`, {
  version: import.meta.env.DEV ? "draft" : "published",
})
---

<Layout>
  <StoryblokComponent blok={data.story.content} id={data.story.id} />
</Layout>
