---
import Layout from "../../layouts/Layout.astro"
import type { Story } from "../../lib/blog"
import StoryblokComponent from "@storyblok/astro/StoryblokComponent.astro"
import { useStoryblokApi } from "@storyblok/astro"

const storyblokApi = useStoryblokApi()

export async function getStaticPaths() {
  const { data } = await useStoryblokApi().getStories({
    version: import.meta.env.DEV ? "draft" : "published",
    sort_by: "content.createdAt:desc",
  })
  // console.log({ data })

  return data.stories.map((story: { slug: string }) => ({
    params: {
      slug: story.slug,
    },
  }))
}

const { slug } = Astro.params
const newestStories: Story[] = []
// (await fetchStories())
//   .filter((s) => s.slug !== slug)
//   .slice(0, 2)

const { data } = await storyblokApi.get(`cdn/stories/${slug}`, {
  version: import.meta.env.DEV ? "draft" : "published",
})
// console.log({ content: data.story.content })
---

<Layout>
  <StoryblokComponent blok={data.story.content} id={data.story.id} />
</Layout>
